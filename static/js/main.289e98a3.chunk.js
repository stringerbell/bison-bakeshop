(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{25:function(e,t,n){},35:function(e,t,n){},48:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n(1),a=n.n(r),i=n(18),s=n.n(i),o=(n(35),n(2)),u=n.n(o),l=n(7),d=n(6),j=n(19),b=n.n(j),p=n(3),h=n(27),f=n(28),O=n.p+"static/media/rolls.35d1b099.jpg";function m(e){return e.condition?e.children:e.fallback}function x(e){e.date;return Object(c.jsx)(c.Fragment,{children:"We're out of stock."})}var y=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.quantity,c=t.date,r=t.id,e.abrupt("return",fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:n,id:r,date:c})}).then((function(e){return e.json()})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(e){var t,n=e.amount,c=e.discountAmount,r=e.currency,a=e.quantity,i=new Intl.NumberFormat("en-US",{style:"currency",currency:r,currencyDisplay:"symbol"}),s=i.formatToParts(n),o=!0,u=Object(h.a)(s);try{for(u.s();!(t=u.n()).done;){"decimal"===t.value.type&&(o=!1)}}catch(d){u.e(d)}finally{u.f()}c=o?c:c/100;var l=(n=o?n:n/100)*a;return a>3&&(l=a*c),i.format(l.toFixed(2))};function v(e,t){switch(t.type){case"useEffectUpdate":return Object(p.a)(Object(p.a)(Object(p.a)({},e),t.payload),{},{price:g({amount:t.payload.unitAmount,discountAmount:t.payload.discountAmount,currency:t.payload.currency,quantity:e.quantity})});case"increment":return Object(p.a)(Object(p.a)({},e),{},{quantity:e.quantity+1,price:g({amount:e.unitAmount,discountAmount:e.discountAmount,currency:e.currency,quantity:e.quantity+1})});case"decrement":return Object(p.a)(Object(p.a)({},e),{},{quantity:e.quantity-1,price:g({amount:e.unitAmount,discountAmount:e.discountAmount,currency:e.currency,quantity:e.quantity-1})});case"setLoading":return Object(p.a)(Object(p.a)({},e),{},{loading:t.payload.loading});case"setError":return Object(p.a)(Object(p.a)({},e),{},{error:t.payload.error});default:throw new Error}}var w=function(e){var t,n=e.selected,a=n.date,i=n.available,s=n.id,o=Object(r.useReducer)(v,{quantity:1,price:null,discountAmount:null,loading:!1,error:null,stripe:null}),j=Object(d.a)(o,2),b=j[0],p=j[1];Object(r.useEffect)((function(){function e(){return(e=Object(l.a)(u.a.mark((function e(){var t,n,c,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/config").then((function(e){return e.json()}));case 2:return t=e.sent,n=t.publicKey,c=t.unitAmount,r=t.discountAmount,a=t.currency,e.t0=p,e.t1=c,e.t2=r,e.t3=a,e.next=13,Object(f.a)(n);case 13:e.t4=e.sent,e.t5={unitAmount:e.t1,discountAmount:e.t2,currency:e.t3,stripe:e.t4},e.t6={type:"useEffectUpdate",payload:e.t5},(0,e.t0)(e.t6);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var h=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,c,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p({type:"setLoading",payload:{loading:!0}}),e.next=3,y({quantity:b.quantity,id:s,date:new Date(a).toISOString()});case 3:if(n=e.sent,void 0!==(c=n.sessionId)){e.next=9;break}return p({type:"setLoading",payload:{loading:!1}}),window.location.reload(),e.abrupt("return");case 9:return e.next=11,b.stripe.redirectToCheckout({sessionId:c});case 11:r=e.sent,(i=r.error)&&(p({type:"setError",payload:{error:i}}),p({type:"setLoading",payload:{loading:!1}}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.jsx)(m,{condition:0!==i,fallback:Object(c.jsx)(x,{}),children:Object(c.jsx)("div",{className:"sr-root",children:Object(c.jsx)("div",{className:"sr-main",children:Object(c.jsxs)("section",{className:"container",children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:"Cinnamon Roll"}),Object(c.jsxs)("h4",{children:["Pre-order a cinnamon roll for ",a]}),Object(c.jsx)("div",{className:"pasha-image",children:Object(c.jsx)("img",{alt:"Cinnamon Rolls",src:O,width:"100%"})})]}),Object(c.jsxs)("div",{className:"quantity-setter",children:[Object(c.jsx)("button",{className:"increment-btn",disabled:1===b.quantity,onClick:function(){return p({type:"decrement"})},children:"-"}),Object(c.jsx)("input",{type:"number",id:"quantity-input",min:"1",max:i,value:b.quantity,readOnly:!0}),Object(c.jsx)("button",{className:"increment-btn",disabled:b.quantity===Math.min(i,12),onClick:function(){return p({type:"increment"})},children:"+"})]}),Object(c.jsxs)("p",{className:"sr-legal-text",children:["Number of rolls (max ",Math.min(i,12),")"]}),Object(c.jsx)("p",{className:"price",children:"".concat(b.price||"")}),Object(c.jsx)("p",{className:"",children:"I'll need a credit card to confirm your order. It won't be charged until pickup."}),Object(c.jsx)("button",{role:"link",disabled:!b.stripe||b.loading,onClick:h,children:b.loading||!b.price?"Loading...":"Reserve my rolls"}),Object(c.jsx)("div",{className:"sr-field-error",children:null===(t=b.error)||void 0===t?void 0:t.message})]})})})})},k=(n(48),n(25),n(10)),N=n.p+"static/media/logo.62cb149e.svg";function q(e,t){switch(t.type){case"useEffectUpdate":return t.payload;default:return[]}}function A(){var e=Object(r.useState)({}),t=Object(d.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(!1),s=Object(d.a)(i,2),o=s[0],j=s[1],p=Object(r.useState)({}),h=Object(d.a)(p,2),f=h[0],O=h[1],x=Object(r.useReducer)(q,[]),y=Object(d.a)(x,2),g=y[0],v=y[1];Object(r.useEffect)((function(){function e(){return(e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/pre-sales").then((function(e){return e.json()}));case 2:t=e.sent,v({type:"useEffectUpdate",payload:t});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){function e(){return(e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/me").then((function(e){return e.json()}));case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var A=function(e){return 0===e?"Sold Out!":e<=6?"Only ".concat(e," left!"):"".concat(e," available")},S=function(){O({}),j(!1)};return b.a.setAppElement("#root"),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(m,{condition:!n.logged_in,fallback:Object(c.jsx)(k.b,{className:"login-link",to:"/logout",children:Object(c.jsx)("button",{children:"Logout"})}),children:Object(c.jsx)(k.b,{className:"login-link",to:"/login",children:Object(c.jsx)("button",{children:"Login"})})}),Object(c.jsx)("header",{className:"App-header",children:Object(c.jsx)("img",{src:N,className:"App-logo",alt:"logo"})}),Object(c.jsxs)("div",{className:"pre-order-container",children:[Object(c.jsx)("p",{className:"p",children:"Pre-order cinnamon rolls:"}),Object(c.jsx)("ul",{className:"pre-order-list",children:g.map((function(e){var t=e.available,n=e.date,r=e.id;return Object(c.jsxs)("div",{children:[Object(c.jsx)("button",{disabled:t<=0,onClick:function(e){return function(e,t){var n=t.date,c=t.id,r=t.available;O({date:n,available:r,id:c}),j(!0)}(0,{date:n,id:r,available:t})},className:"pre-order-date",children:n}),Object(c.jsx)("span",{className:"qty",children:A(t)})]},r)}))}),Object(c.jsxs)(b.a,{isOpen:o,onRequestClose:S,contentLabel:"Pre-Order A Roll",children:[Object(c.jsx)("div",{onClick:S,className:"close-modal-btn",children:"\u2716"}),Object(c.jsx)(w,{selected:f})]})]})]})}var S=n(4);n(52);function C(){var e=Object(r.useState)({error:"",success:"",loading:!1}),t=Object(d.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(""),s=Object(d.a)(i,2),o=s[0],j=s[1],b=Object(S.g)().search.replace("?s=","");Object(r.useEffect)((function(){function e(){return(e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/checkout-session?sessionId="+b).then((function(e){return e.json()}));case 2:t=e.sent,j(t.customer_email);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[b]);var h=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(Object(p.a)(Object(p.a)({},n),{},{loading:!0})),e.next=3,fetch("/api/account",{method:"POST",body:JSON.stringify({sessionId:b,email:o})}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(e){a(Object(p.a)(Object(p.a)({},n),{},{error:"",success:"All set! Thank you!"}))})).then((function(){return e=3e3,new Promise((function(t){return setTimeout(t,e)}));var e})).then((function(){return window.location.href="/"})).catch((function(e){switch(e.message){case"409":a(Object(p.a)(Object(p.a)({},n),{},{success:"",error:"You already have an account with us."}));break;case"400":a(Object(p.a)(Object(p.a)({},n),{},{success:"",error:"stop trying to hack me, plz"}));break;default:a(Object(p.a)(Object(p.a)({},n),{},{success:"",error:"something went wrong \ud83d\ude2d"}))}}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(c.jsxs)("div",{className:"success-wrapper-outer",children:[Object(c.jsx)(k.b,{to:"/",children:Object(c.jsx)("img",{src:N,className:"App-logo",alt:"logo"})}),Object(c.jsx)("p",{children:"Thank you for your order!"}),Object(c.jsx)("p",{children:"Check your email for pickup instructions."}),Object(c.jsx)("div",{className:"success-wrapper",children:Object(c.jsxs)("div",{className:"md-vw success-wrapper-inner",children:[Object(c.jsx)("p",{children:"Create an account for faster reservations in the future?"}),Object(c.jsx)("input",{className:"md-vw",disabled:n.success,value:o,onChange:function(e){return j(e.target.value)}}),Object(c.jsxs)(m,{condition:n.error,fallback:null,children:[Object(c.jsx)("h1",{className:"md-vw",children:n.error}),Object(c.jsx)(k.b,{to:"/login?email=".concat(o),children:Object(c.jsx)("button",{children:"Login"})})]}),Object(c.jsx)(m,{condition:n.success,fallback:null,children:Object(c.jsx)("h1",{className:"md-vw",children:n.success})}),Object(c.jsx)("button",{className:"button md-vw",disabled:n.loading||n.success,onClick:h,children:"Create Account"})]})})]})}n(53);function E(){var e=Object(S.g)().search,t=Object(r.useState)(e.replace("?email=","")),n=Object(d.a)(t,2),a=n[0],i=n[1],s=Object(r.useState)(!1),o=Object(d.a)(s,2),u=o[0],l=o[1];Object(r.useEffect)((function(){fetch("/api/me").then((function(e){return e.json()})).then((function(e){e.logged_in&&(window.location.href="/")}))}),[]);return Object(c.jsxs)("div",{className:"login-wrapper",children:[Object(c.jsx)(k.b,{to:"/",children:Object(c.jsx)("img",{src:N,className:"App-logo",alt:"logo"})}),Object(c.jsxs)(m,{condition:!u,fallback:Object(c.jsx)("h1",{children:"Check your email, and click the link to login."}),children:[Object(c.jsx)("h1",{children:"Login with your email"}),Object(c.jsx)("div",{className:"login-inner-wrapper",children:Object(c.jsxs)("form",{onSubmit:function(e){e.preventDefault(),fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})}).then((function(e){return e.json()})).then((function(e){return l(!0)}))},children:[Object(c.jsx)("input",{type:"email",required:!0,placeholder:"email",value:a,onChange:function(e){return i(e.target.value)}}),Object(c.jsx)("button",{type:"sumbit",children:"Login"})]})})]})]})}function L(){var e=Object(S.h)().token,t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],i=n[1];return Object(r.useEffect)((function(){function t(){return(t=Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/api/session",{method:"POST",body:JSON.stringify({token:e})}).then((function(e){return e.json()})).then((function(e){i(e.location)}));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}void 0!==e&&function(){t.apply(this,arguments)}()}),[]),a&&Object(c.jsx)(S.a,{to:a})}function T(){var e=Object(r.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){function e(){return(e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/logout").then((function(e){return e.json()})).then((function(){return a(!0)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),n&&Object(c.jsx)(S.a,{to:"/"})}var P=function(){return Object(c.jsx)("div",{className:"App",children:Object(c.jsx)(k.a,{children:Object(c.jsxs)(S.d,{children:[Object(c.jsx)(S.b,{exact:!0,path:"/",children:Object(c.jsx)(A,{})}),Object(c.jsx)(S.b,{exact:!0,path:"/login/:token",children:Object(c.jsx)(L,{})}),Object(c.jsx)(S.b,{exact:!0,path:"/login",children:Object(c.jsx)(E,{})}),Object(c.jsx)(S.b,{exact:!0,path:"/logout",children:Object(c.jsx)(T,{})}),Object(c.jsx)(S.b,{exact:!0,path:"/success",children:Object(c.jsx)(C,{})})]})})})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,57)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),c(e),r(e),a(e),i(e)}))};n(54),n(55);s.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(P,{})}),document.getElementById("root")),I()}},[[56,1,2]]]);
//# sourceMappingURL=main.289e98a3.chunk.js.map